import * as d3 from 'd3';
import { Subject, fromEvent } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { D3NodeBasicParser } from './@items';
import { calcGFit, setPattern, addDefaultDefs, buildTree } from './d3x/d3x';
export class D3OrgChart {
    constructor(prContainer, prOptions) {
        var _a, _b;
        //#region Default Options
        this.options = {
            backgroundColor: '#03A3C5',
            nodeParser: new D3NodeBasicParser(),
            data: [],
            defaultFont: 'Tahoma',
            nodeHorizontalSpaceScale: 0.5,
            nodeVerticalSpaceScale: 0.8
        };
        // protected allNodes: any;
        this._data = [];
        //#endregion
        this.zoomFunc = d3.zoom().scaleExtent([0.1, 20]).on("zoom", d => this.zoomed());
        this.currentZoom = 1;
        //#region Events
        // node click
        this.onNodeClick = new Subject();
        const me = this;
        // init container
        me.container = d3.select(prContainer);
        //If Data argument passed - then set it
        if ((_a = prOptions) === null || _a === void 0 ? void 0 : _a.data)
            me._data = prOptions.data;
        // setting parser
        me._nodeParser = ((_b = prOptions) === null || _b === void 0 ? void 0 : _b.nodeParser) || me.options.nodeParser;
        // applying options
        me.options = Object.assign(me.options, prOptions);
        // monitor resize
        fromEvent(prContainer, 'resize')
            .pipe(debounceTime(300)).subscribe(() => {
            // HDC - VER this.prepareCanvas();
            console.log('resize container');
            this.render();
        });
        fromEvent(window, 'resize')
            .pipe(debounceTime(300)).subscribe(() => {
            // HDC - VER this.prepareCanvas();
            console.log('resize window');
            this.render();
        });
    }
    get nodeParser() {
        if (!this._nodeParser)
            this._nodeParser = new D3NodeBasicParser();
        return this._nodeParser;
    }
    set nodeParser(parser) {
        this._nodeParser = parser;
        // this.render();
    }
    get data() {
        return this._data || [];
    }
    set data(data) {
        this._data = data;
        // this.render()
    }
    render() {
        const me = this;
        // preparing svg
        me.prepareCanvas();
        // if no data then return
        if (!me.data.length)
            return;
        // preparing data
        me.prepareData();
        // showing nodes
        me.showNodes();
        return this;
    }
    // preparing canvas
    prepareCanvas() {
        const me = this;
        //Drawing containers
        const containerRect = me.container.node().getBoundingClientRect();
        // console.log('Container resct: ', containerRect)
        me.svg = me.container.selectAll('svg')
            .data([{ id: 'svg' }], (d) => d.id)
            .join(enter => enter
            .append('svg')
            .attr('class', 'svg-chart-container')
            .attr('font-family', me.options.defaultFont)
            // .call(d3.zoom().on("zoom", d => this.zoomed()))
            .call(this.zoomFunc)
            .on("dblclick.zoom", null)
            .attr('cursor', 'move')
            .style('background-color', me.options.backgroundColor), update => update
            .attr('width', containerRect.width)
            .attr('height', containerRect.height)
            .attr('font-family', me.options.defaultFont)
            .style('background-color', me.options.backgroundColor))
            .attr('width', containerRect.width)
            .attr('height', containerRect.height)
            .attr('font-family', me.options.defaultFont)
            .style('background-color', me.options.backgroundColor);
        //Add container g element
        me.chart = me.svg.selectAll('g.chart')
            .data([{ id: 'chart' }], (d) => d.id)
            .join(enter => enter
            .append('g')
            .attr('class', 'chart')
            .attr('transform', `translate(0,0)`), update => update);
        if (!me.lastTransform)
            me.svg.transition().duration(200).call(me.zoomFunc.transform, d3.zoomIdentity.translate(containerRect.width / 2, this.nodeParser.height).scale(1));
        //Add container g element
        me.tb = me.svg.selectAll('g.toolbar')
            .data([{ id: 'toolbar' }], (d) => d.id)
            .join(enter => enter
            .append('g')
            .attr('class', 'toolbar')
            .attr('transform', `translate(10,10)`)
            .append('rect')
            .attr('width', 30)
            .attr('height', 30)
            .attr('fill', 'url(#img-fit-icon)')
            .attr('cursor', 'pointer')
            .on('click', () => me.fit()), update => update);
        me.prepareDefs();
    }
    // preparing defs
    prepareDefs() {
        const me = this;
        // defs
        me.defs = me.svg.selectAll('defs.globalDefs')
            .data([{ id: 'defs' }], (d) => d.id)
            .join(enter => {
            const defs = enter.append('defs').attr('class', 'globalDefs');
            addDefaultDefs(defs, {
                'expand-icon': {
                    type: 'icon',
                    backgroundColor: '#05C356',
                    scale: 0.6,
                    color: '#EAFA48',
                    name: 'faPlus'
                },
                'collapse-icon': {
                    type: 'icon',
                    backgroundColor: '#D10303',
                    scale: 0.6,
                    color: '#EAFA48',
                    name: 'faMinus'
                },
                'fit-icon': {
                    type: 'icon',
                    backgroundColor: '#074EF3',
                    scale: 0.9,
                    color: '#EAFA48',
                    name: 'faExpand'
                },
                'default-node-img': me.nodeParser.defaultImage
            }, me.nodeParser);
            //addDefs(defs, me.defsElements);
            return defs;
        }, update => update);
    }
    // preparing data
    prepareData() {
        const me = this;
        // if no data return 
        if (!me.data.length)
            return;
        // Convert flat data to hierarchical
        if (!me.root) {
            try { // preventing multiple root
                me.root = d3.stratify().id(({ nodeId }) => nodeId).parentId(({ parentNodeId }) => parentNodeId)(me.data);
            }
            catch (err) {
                me.root = d3.stratify().id(({ nodeId }) => nodeId).parentId(({ parentNodeId }) => parentNodeId)([{
                        nodeId: 'root',
                        parentNodeId: '',
                        title: 'Error',
                        description: err.message || err,
                        nodeImage: {
                            type: 'base64',
                            data: me.nodeParser.errorBase64Icon
                        }
                    }]);
            }
        }
        // preparing treemap
        const containerRect = me.container.node().getBoundingClientRect();
        me.treemap = d3.tree() //.size([containerRect.width || 250, containerRect.height])
            .nodeSize([
            (me.nodeParser.width + (this.nodeParser.width * me.options.nodeHorizontalSpaceScale || 0.5)) * 0,
            (me.nodeParser.height + (this.nodeParser.height * me.options.nodeVerticalSpaceScale || 0.8)) * 0
        ])
            .separation((a, b) => {
            return 1;
        });
        // me.allNodes = me.treemap(me.root).descendants();
        me.checkExpanded(me.root);
    }
    // showing nodes
    showNodes(prNode = null) {
        const me = this;
        if (!prNode)
            prNode = me.root;
        const nodeRef = {
            x: prNode.x || 0,
            y: prNode.y || 0,
            parent: prNode.parent
        };
        // console.log('Node Before: ', nodeRef.x);
        const updatePosition = {
            x: prNode.x || 0,
            y: prNode.y || 0
        };
        //  Assigns the x and y position for the nodes
        const treeData = me.treemap(me.root);
        // it is necesary for scope 
        const drawNodes = (container) => me.nodeParser.drawNodes(container, me.onNodeClick);
        const drawCollapser = (nodeGroup) => {
            nodeGroup.append('circle')
                .attr('class', 'collapser')
                .attr('cx', me.nodeParser.width / 2)
                .attr('cy', me.nodeParser.height)
                .attr('r', 15)
                .attr('stroke', 'black')
                .attr('stroke-width', 2)
                .on('click', (node) => {
                // console.log('Node X: ', node.x)
                d3.event.preventDefault();
                me.expand(node, true);
            });
        };
        // console.log('Node ref: ', prNode.x, nodeRef.x, nodeRef )
        const nodes = treeData.descendants();
        // probanding
        buildTree(me.root, {
            w: me.nodeParser.width + (this.nodeParser.width * me.options.nodeHorizontalSpaceScale || 0.5),
            h: me.nodeParser.height + (this.nodeParser.height * me.options.nodeVerticalSpaceScale || 0.8)
        });
        // console.log('Nodes: ', nodes);
        // preparing all definitions for nodes
        me.defs.selectAll('pattern.node')
            .data(nodes, (d) => d.data.nodeId)
            .join(enter => enter.filter(d => d.data.nodeImage != null)
            .append('pattern').attr('class', 'node')
            .each((nodeData, i, enterNodes) => {
            // adding pattern
            const pattern = d3.select(enterNodes[i]);
            setPattern(pattern, nodeData.data, me.nodeParser);
        }), update => update, exit => exit
            .transition()
            .duration(me.nodeParser.transitionDuration)
            .style("opacity", 0)
            .remove());
        // rendering nodes
        const nodeStartPosition = (d) => {
            if (nodeRef) {
                return `translate(${nodeRef.x - (me.nodeParser.width / 2)},${nodeRef.y})`;
            }
            if (!d.parent)
                return `translate(${d.x - (me.nodeParser.width / 2)},${d.y})`;
            return `translate(${d.parent.x - (me.nodeParser.width / 2)},${d.parent.y})`;
        };
        const collapserStartPosition = (d) => {
            if (nodeRef)
                return nodeRef;
            if (!d.parent)
                return d;
            return d.parent;
        };
        const nodePosition = (params) => `translate(${params.x - (me.nodeParser.width / 2)},${params.y})`;
        const collapserPosition = (params) => `translate(${params.x},${params.y})`;
        const expandIconVisible = (d) => (d.children || d._children) ? 'visible' : 'hidden';
        const expandIcon = (d) => expandIconVisible(d) == 'visible' ? (d.data.expanded ? `url(#img-collapse-icon)` : `url(#img-expand-icon)`) : '';
        const collapserCursor = (d) => expandIconVisible(d) == 'visible' ? (d.data.expanded ? `zoom-out` : `zoom-in`) : 'default';
        me.chart.selectAll('g.node')
            .data(nodes, (d) => d.data.nodeId)
            .join(enter => enter.append('g')
            .style("opacity", 0)
            .attr('class', 'node')
            .attr('cursor', 'pointer')
            .attr('transform', nodeStartPosition)
            .call(drawNodes)
            // .call(drawCollapser)
            .on('dblclick', (node) => {
            const containerRect = me.container.node().getBoundingClientRect();
            me.traslateTo((containerRect.width / 2) - node.x, ((containerRect.height - me.nodeParser.height) / 2) - node.y);
        }), update => update, exit => exit
            .transition()
            .duration(me.nodeParser.transitionDuration)
            .attr('transform', nodePosition(prNode))
            .style("opacity", 0)
            .remove())
            .transition().duration(me.nodeParser.transitionDuration)
            .style("opacity", 1)
            .attr('transform', nodePosition);
        //.selectAll('circle.collapser')
        //.attr('visibility', expandIconVisible)
        //.attr('fill', expandIcon)
        me.chart.selectAll('circle.collapser')
            .data(nodes, (d) => d.data.nodeId)
            .join(enter => enter.append('circle')
            .attr('class', 'collapser')
            .style("opacity", 0)
            .attr('cx', (d) => collapserStartPosition(d).x)
            .attr('cy', (d) => collapserStartPosition(d).y + me.nodeParser.height)
            .attr('r', 15)
            .attr('stroke', 'black')
            .attr('stroke-width', 2)
            .on('click', (node) => {
            // console.log('Node X: ', node.x)
            d3.event.preventDefault();
            me.expand(node, true);
        }), update => update, exit => exit
            .transition().duration(me.nodeParser.transitionDuration)
            .attr('cx', (d) => collapserStartPosition(d).x)
            .attr('cy', (d) => collapserStartPosition(d).y + me.nodeParser.height)
            .style("opacity", 0)
            .remove())
            .transition().duration(me.nodeParser.transitionDuration)
            .style("opacity", 1)
            .attr('cx', (d) => d.x)
            .attr('cy', (d) => d.y + me.nodeParser.height)
            .attr('visibility', expandIconVisible)
            .attr('fill', expandIcon)
            .attr('cursor', collapserCursor);
        // rendering links
        const pathStartingDiagonal = (d) => {
            return this.linkPath(d, d);
        };
        const pathDiagonal = (d) => {
            const target = { x: d.parent.x, y: d.parent.y + me.nodeParser.height };
            return this.linkPath(d, d.parent);
        };
        me.chart.selectAll('path.link')
            .data(nodes.slice(1), (d) => d.data.nodeId)
            .join(enter => enter
            .insert('path', 'g')
            .attr('class', 'link')
            .attr('fill', 'none')
            .attr('stroke', 'blue')
            .attr('stroke-width', 2)
            .attr('d', pathStartingDiagonal(nodeRef)), update => update, exit => exit
            .transition().duration(me.nodeParser.transitionDuration)
            .attr('d', pathStartingDiagonal(prNode))
            .remove())
            .transition().duration(me.nodeParser.transitionDuration)
            .attr('d', pathDiagonal);
    }
    // Zoom handler function
    zoomed() {
        const me = this;
        // Saving d3 event's transform object
        me.lastTransform = d3.event.transform;
        // Reposition and rescale chart accordingly
        if (isNaN(me.lastTransform.k) || isNaN(me.lastTransform.x) || isNaN(me.lastTransform.y))
            return;
        me.chart.attr('transform', d3.event.transform);
    }
    _onNodeClick(nodeId, node) {
        this.onNodeClick.next({ id: nodeId, node: node });
    }
    //#endregion
    // Generate custom diagonal - play with it here - https://observablehq.com/@bumbeishvili/curved-edges?collection=@bumbeishvili/work-components
    linkPath(source, target) {
        const me = this;
        // Calculate some variables based on source and target (s,t) coordinates
        let x = source.x;
        let y = source.y;
        const ex = target.x;
        const ey = target.y + me.nodeParser.height;
        const linkHeight = 25;
        const curveRadius = Math.abs(x - ex) != 0 ? 15 : 0;
        let xrvs = ex - x < 0 ? -1 : 1;
        let yrvs = ey - y < 0 ? -1 : 1;
        let w = Math.abs(ex - x) - (curveRadius * 2);
        const path = `
      M ${x} ${y}
      L ${x} ${y + (linkHeight * yrvs)}
      C ${x} ${y + ((linkHeight + curveRadius) * yrvs)} ${x} ${y + ((linkHeight + curveRadius) * yrvs)} ${x + (curveRadius * xrvs)} ${y + ((linkHeight + curveRadius) * yrvs)}
      L ${x + ((w + curveRadius) * xrvs)} ${y + ((linkHeight + curveRadius) * yrvs)}
      C ${ex}  ${y + ((linkHeight + curveRadius) * yrvs)} ${ex}  ${y + ((linkHeight + curveRadius) * yrvs)} ${ex} ${y + ((linkHeight + curveRadius) * yrvs) + (curveRadius * yrvs)}
      L ${ex} ${ey}
    `;
        return path;
    }
    checkExpanded(node) {
        const me = this;
        // checking expanded
        if (node.data.expanded) {
            if (!node.children && node._children) {
                node.children = node._children;
                node._children = null;
            }
        }
        else { // collapsed
            if (node.children) {
                node._children = node.children;
                node.children = null;
            }
        }
        // checking children
        (node.children || node._children || []).forEach(current => me.checkExpanded(current));
    }
    expand(node, toggle = false) {
        const me = this;
        const nodeRef = Object.assign(node);
        // if toggle - lets toggle
        if (toggle)
            node.data.expanded = !node.data.expanded;
        // checking expanded
        if (node.data.expanded) {
            if (!node.children && node._children) {
                node.children = node._children;
                node._children = null;
            }
        }
        else { // collapsed
            if (node.children) {
                node._children = node.children;
                node.children = null;
            }
        }
        // expand(node.children, node.data.expanded);
        // console.log('Before expand: ', nodeRef.x,  node.x)
        if (toggle)
            me.showNodes(node);
    }
    traslateTo(prX, prY) {
        const me = this;
        me.svg
            .transition().duration(me.nodeParser.transitionDuration)
            .call(me.zoomFunc.transform, d3.zoomIdentity.translate(prX, prY));
    }
    fit() {
        const me = this;
        // const zoom = d3.zoom().on("zoom", d => this.zoomed())
        if (!me.root)
            return;
        const fit = calcGFit(me.chart, me.svg, me.root, me.nodeParser);
        me.svg.transition().duration(me.nodeParser.transitionDuration).call(me.zoomFunc.transform, d3.zoomIdentity.translate(fit.x, fit.y).scale(fit.scale));
    }
    setOptions(prOptions) {
        const me = this;
        me.options = Object.assign(me.options, prOptions);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZDMtb3JnLWNoYXJ0LmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYmUtb3JnY2hhcnQvIiwic291cmNlcyI6WyJsaWIvY2xhc2Vzcy9kMy1vcmctY2hhcnQuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFFekIsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUU3QyxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsU0FBUyxFQUFhLE1BQU0sV0FBVyxDQUFDO0FBWXZGLE1BQU0sT0FBTyxVQUFVO0lBd0RyQixZQUFZLFdBQXdCLEVBQUUsU0FBOEI7O1FBdkRwRSx5QkFBeUI7UUFDZixZQUFPLEdBQXVCO1lBQ3RDLGVBQWUsRUFBRSxTQUFTO1lBQzFCLFVBQVUsRUFBRSxJQUFJLGlCQUFpQixFQUFFO1lBQ25DLElBQUksRUFBRSxFQUFFO1lBQ1IsV0FBVyxFQUFFLFFBQVE7WUFDckIsd0JBQXdCLEVBQUUsR0FBRztZQUM3QixzQkFBc0IsRUFBRSxHQUFHO1NBQzVCLENBQUE7UUE2QkQsMkJBQTJCO1FBRWpCLFVBQUssR0FBYyxFQUFFLENBQUM7UUFTaEMsWUFBWTtRQUVaLGFBQVEsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBRTNFLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBK1p4QixnQkFBZ0I7UUFDaEIsYUFBYTtRQUNiLGdCQUFXLEdBQTJDLElB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TSxFQUFFLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQztRQUUzQyxNQUFNLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDdEIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVuRCxJQUFJLElBQUksR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQixJQUFJLElBQUksR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUU3QyxNQUFNLElBQUksR0FBRztVQUNQLENBQUMsSUFBSSxDQUFDO1VBQ04sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7VUFDNUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFVBQVUsR0FBRyxXQUFXLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxVQUFVLEdBQUcsV0FBVyxDQUFDLEdBQUcsSUFBSSxDQUFDO1VBQ25LLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMs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LEdBQUcsQ0FBQyxDQUNwQyxDQUFDO0lBQ04sQ0FBQztJQUVELEdBQUc7UUFDRCxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDaEIsd0RBQXdEO1FBQ3hELElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSTtZQUFFLE9BQU87UUFFckIsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUM5RCxFQUFFLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxDQUNqRSxFQUFFLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFDckIsRUFBRSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FDekQsQ0FBQztJQUNKLENBQUM7SUFFRCxVQUFVLENBQUMsU0FBc0M7UUFDL0MsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLEVBQUUsQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3BELENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGQzIGZyb20gJ2QzJztcclxuaW1wb3J0IHsgSUQzTm9kZSwgSUltYWdlRGVmIH0gZnJvbSAnLi4vaW50ZXJmYWNlcyc7XHJcbmltcG9ydCB7IFN1YmplY3QsIGZyb21FdmVudCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEQzTm9kZUJhc2ljUGFyc2VyIH0gZnJvbSAnLi9AaXRlbXMnO1xyXG5cclxuaW1wb3J0IHsgY2FsY0dGaXQsIHNldFBhdHRlcm4sIGFkZERlZmF1bHREZWZzLCBidWlsZFRyZWUsIElSb290Tm9kZSB9IGZyb20gJy4vZDN4L2QzeCc7XHJcbmltcG9ydCB7IEJhc2VUeXBlIH0gZnJvbSAnZDMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJRDNPcmdDaGFydE9wdGlvbnMge1xyXG4gIG5vZGVQYXJzZXI/OiBEM05vZGVCYXNpY1BhcnNlcjtcclxuICBkYXRhPzogSUQzTm9kZVtdO1xyXG4gIGJhY2tncm91bmRDb2xvcj86IHN0cmluZztcclxuICBkZWZhdWx0Rm9udD86IHN0cmluZztcclxuICBub2RlSG9yaXpvbnRhbFNwYWNlU2NhbGU/OiBudW1iZXI7XHJcbiAgbm9kZVZlcnRpY2FsU3BhY2VTY2FsZT86IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEQzT3JnQ2hhcnQge1xyXG4gIC8vI3JlZ2lvbiBEZWZhdWx0IE9wdGlvbnNcclxuICBwcm90ZWN0ZWQgb3B0aW9uczogSUQzT3JnQ2hhcnRPcHRpb25zID0ge1xyXG4gICAgYmFja2dyb3VuZENvbG9yOiAnIzAzQTNDNScsXHJcbiAgICBub2RlUGFyc2VyOiBuZXcgRDNOb2RlQmFzaWNQYXJzZXIoKSxcclxuICAgIGRhdGE6IFtdLFxyXG4gICAgZGVmYXVsdEZvbnQ6ICdUYWhvbWEnLFxyXG4gICAgbm9kZUhvcml6b250YWxTcGFjZVNjYWxlOiAwLjUsXHJcbiAgICBub2RlVmVydGljYWxTcGFjZVNjYWxlOiAwLjhcclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiAgTk9ERSBQQVJTRVJcclxuICBwcm90ZWN0ZWQgX25vZGVQYXJzZXI6IEQzTm9kZUJhc2ljUGFyc2VyO1xyXG4gIGdldCBub2RlUGFyc2VyKCk6IEQzTm9kZUJhc2ljUGFyc2VyIHtcclxuICAgIGlmICghdGhpcy5fbm9kZVBhcnNlcikgdGhpcy5fbm9kZVBhcnNlciA9IG5ldyBEM05vZGVCYXNpY1BhcnNlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuX25vZGVQYXJzZXI7XHJcbiAgfVxyXG4gIHNldCBub2RlUGFyc2VyKHBhcnNlcjogRDNOb2RlQmFzaWNQYXJzZXIpIHtcclxuICAgIHRoaXMuX25vZGVQYXJzZXIgPSBwYXJzZXI7XHJcbiAgICAvLyB0aGlzLnJlbmRlcigpO1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuXHJcbiAgLy8jcmVnaW9uIFNWRyBjb21wb25lbnRzXHJcbiAgcHJvdGVjdGVkIGNvbnRhaW5lcjogZDMuU2VsZWN0aW9uPEhUTUxFbGVtZW50LCBhbnksIGFueSwgYW55PjtcclxuICBwcm90ZWN0ZWQgc3ZnOiBkMy5TZWxlY3Rpb248U1ZHRWxlbWVudCwgdW5rbm93biwgSFRNTEVsZW1lbnQsIHVua25vd24+O1xyXG4gIHByb3RlY3RlZCB0YjogZDMuU2VsZWN0aW9uPGFueSwgYW55LCBhbnksIGFueT47XHJcblxyXG4gIHByb3RlY3RlZCBjaGFydDogZDMuU2VsZWN0aW9uPFNWR0dFbGVtZW50LCBhbnksIEJhc2VUeXBlLCBhbnk+O1xyXG4gIC8vIHByb3RlY3RlZCBjZW50ZXJHOiBkMy5TZWxlY3Rpb248YW55LCBhbnksIGFueSwgYW55PjtcclxuICBwcm90ZWN0ZWQgZGVmczogZDMuU2VsZWN0aW9uPGFueSwgYW55LCBhbnksIGFueT47XHJcblxyXG4gIHByb3RlY3RlZCBsYXN0VHJhbnNmb3JtOiBhbnk7XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiBEQVRBXHJcbiAgcHJvdGVjdGVkIHJvb3Q6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPjtcclxuICAvLyBwcm90ZWN0ZWQgYWxsTm9kZXM6IGFueTtcclxuXHJcbiAgcHJvdGVjdGVkIF9kYXRhOiBJRDNOb2RlW10gPSBbXTtcclxuICBnZXQgZGF0YSgpOiBJRDNOb2RlW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2RhdGEgfHwgW107XHJcbiAgfVxyXG5cclxuICBzZXQgZGF0YShkYXRhOiBJRDNOb2RlW10pIHtcclxuICAgIHRoaXMuX2RhdGEgPSBkYXRhO1xyXG4gICAgLy8gdGhpcy5yZW5kZXIoKVxyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuXHJcbiAgem9vbUZ1bmMgPSBkMy56b29tKCkuc2NhbGVFeHRlbnQoWzAuMSwgMjBdKS5vbihcInpvb21cIiwgZCA9PiB0aGlzLnpvb21lZCgpKTtcclxuXHJcbiAgY3VycmVudFpvb206IG51bWJlciA9IDE7XHJcbiAgdHJlZW1hcDogZDMuVHJlZUxheW91dDxJRDNOb2RlPjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJDb250YWluZXI6IEhUTUxFbGVtZW50LCBwck9wdGlvbnM/OiBJRDNPcmdDaGFydE9wdGlvbnMpIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuXHJcbiAgICAvLyBpbml0IGNvbnRhaW5lclxyXG4gICAgbWUuY29udGFpbmVyID0gZDMuc2VsZWN0KHByQ29udGFpbmVyKTtcclxuXHJcbiAgICAvL0lmIERhdGEgYXJndW1lbnQgcGFzc2VkIC0gdGhlbiBzZXQgaXRcclxuICAgIGlmIChwck9wdGlvbnM/LmRhdGEpIG1lLl9kYXRhID0gcHJPcHRpb25zLmRhdGE7XHJcblxyXG4gICAgLy8gc2V0dGluZyBwYXJzZXJcclxuICAgIG1lLl9ub2RlUGFyc2VyID0gcHJPcHRpb25zPy5ub2RlUGFyc2VyIHx8IG1lLm9wdGlvbnMubm9kZVBhcnNlcjtcclxuXHJcbiAgICAvLyBhcHBseWluZyBvcHRpb25zXHJcbiAgICBtZS5vcHRpb25zID0gT2JqZWN0LmFzc2lnbihtZS5vcHRpb25zLCBwck9wdGlvbnMpO1xyXG5cclxuICAgIC8vIG1vbml0b3IgcmVzaXplXHJcbiAgICBmcm9tRXZlbnQocHJDb250YWluZXIsICdyZXNpemUnKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBkZWJvdW5jZVRpbWUoMzAwKVxyXG4gICAgICApLnN1YnNjcmliZShcclxuICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAvLyBIREMgLSBWRVIgdGhpcy5wcmVwYXJlQ2FudmFzKCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygncmVzaXplIGNvbnRhaW5lcicpXHJcbiAgICAgICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgZnJvbUV2ZW50KHdpbmRvdywgJ3Jlc2l6ZScpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIGRlYm91bmNlVGltZSgzMDApXHJcbiAgICAgICkuc3Vic2NyaWJlKFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIC8vIEhEQyAtIFZFUiB0aGlzLnByZXBhcmVDYW52YXMoKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXNpemUgd2luZG93JylcclxuICAgICAgICAgIHRoaXMucmVuZGVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgfVxyXG5cclxuICByZW5kZXIoKSB7XHJcbiAgICBjb25zdCBtZSA9IHRoaXM7XHJcbiAgICAvLyBwcmVwYXJpbmcgc3ZnXHJcbiAgICBtZS5wcmVwYXJlQ2FudmFzKCk7XHJcblxyXG4gICAgLy8gaWYgbm8gZGF0YSB0aGVuIHJldHVyblxyXG4gICAgaWYgKCFtZS5kYXRhLmxlbmd0aCkgcmV0dXJuO1xyXG5cclxuICAgIC8vIHByZXBhcmluZyBkYXRhXHJcbiAgICBtZS5wcmVwYXJlRGF0YSgpO1xyXG5cclxuICAgIC8vIHNob3dpbmcgbm9kZXNcclxuICAgIG1lLnNob3dOb2RlcygpO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvLyBwcmVwYXJpbmcgY2FudmFzXHJcbiAgcHJvdGVjdGVkIHByZXBhcmVDYW52YXMoKSB7XHJcbiAgICBjb25zdCBtZSA9IHRoaXM7XHJcblxyXG4gICAgLy9EcmF3aW5nIGNvbnRhaW5lcnNcclxuICAgIGNvbnN0IGNvbnRhaW5lclJlY3QgPSBtZS5jb250YWluZXIubm9kZSgpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICAgIC8vIGNvbnNvbGUubG9nKCdDb250YWluZXIgcmVzY3Q6ICcsIGNvbnRhaW5lclJlY3QpXHJcblxyXG4gICAgbWUuc3ZnID0gbWUuY29udGFpbmVyLnNlbGVjdEFsbDxTVkdFbGVtZW50LCBhbnk+KCdzdmcnKVxyXG4gICAgICAuZGF0YShbeyBpZDogJ3N2ZycgfV0sIChkOiB7IGlkOiBzdHJpbmcgfSkgPT4gZC5pZClcclxuICAgICAgLmpvaW4oXHJcbiAgICAgICAgZW50ZXIgPT5cclxuICAgICAgICAgIGVudGVyXHJcbiAgICAgICAgICAgIC5hcHBlbmQoJ3N2ZycpXHJcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdzdmctY2hhcnQtY29udGFpbmVyJylcclxuICAgICAgICAgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgbWUub3B0aW9ucy5kZWZhdWx0Rm9udClcclxuICAgICAgICAgICAgLy8gLmNhbGwoZDMuem9vbSgpLm9uKFwiem9vbVwiLCBkID0+IHRoaXMuem9vbWVkKCkpKVxyXG4gICAgICAgICAgICAuY2FsbCh0aGlzLnpvb21GdW5jKVxyXG4gICAgICAgICAgICAub24oXCJkYmxjbGljay56b29tXCIsIG51bGwpXHJcbiAgICAgICAgICAgIC5hdHRyKCdjdXJzb3InLCAnbW92ZScpXHJcbiAgICAgICAgICAgIC5zdHlsZSgnYmFja2dyb3VuZC1jb2xvcicsIG1lLm9wdGlvbnMuYmFja2dyb3VuZENvbG9yKSxcclxuICAgICAgICB1cGRhdGUgPT5cclxuICAgICAgICAgIHVwZGF0ZVxyXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCBjb250YWluZXJSZWN0LndpZHRoKVxyXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgY29udGFpbmVyUmVjdC5oZWlnaHQpXHJcbiAgICAgICAgICAgIC5hdHRyKCdmb250LWZhbWlseScsIG1lLm9wdGlvbnMuZGVmYXVsdEZvbnQpXHJcbiAgICAgICAgICAgIC5zdHlsZSgnYmFja2dyb3VuZC1jb2xvcicsIG1lLm9wdGlvbnMuYmFja2dyb3VuZENvbG9yKVxyXG4gICAgICApXHJcbiAgICAgIC5hdHRyKCd3aWR0aCcsIGNvbnRhaW5lclJlY3Qud2lkdGgpXHJcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBjb250YWluZXJSZWN0LmhlaWdodClcclxuICAgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgbWUub3B0aW9ucy5kZWZhdWx0Rm9udClcclxuICAgICAgLnN0eWxlKCdiYWNrZ3JvdW5kLWNvbG9yJywgbWUub3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IpXHJcbiAgICAgIDtcclxuXHJcbiAgICAvL0FkZCBjb250YWluZXIgZyBlbGVtZW50XHJcbiAgICBtZS5jaGFydCA9IG1lLnN2Zy5zZWxlY3RBbGw8U1ZHR0VsZW1lbnQsIGFueT4oJ2cuY2hhcnQnKVxyXG4gICAgICAuZGF0YShbeyBpZDogJ2NoYXJ0JyB9XSwgKGQ6IHsgaWQ6IHN0cmluZyB9KSA9PiBkLmlkKVxyXG4gICAgICAuam9pbihcclxuICAgICAgICBlbnRlciA9PiBlbnRlclxyXG4gICAgICAgICAgLmFwcGVuZCgnZycpXHJcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2hhcnQnKVxyXG4gICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoMCwwKWApLFxyXG4gICAgICAgIHVwZGF0ZSA9PiB1cGRhdGVcclxuICAgICAgKVxyXG4gICAgaWYgKCFtZS5sYXN0VHJhbnNmb3JtKVxyXG4gICAgICBtZS5zdmcudHJhbnNpdGlvbigpLmR1cmF0aW9uKDIwMCkuY2FsbChcclxuICAgICAgICBtZS56b29tRnVuYy50cmFuc2Zvcm0sXHJcbiAgICAgICAgZDMuem9vbUlkZW50aXR5LnRyYW5zbGF0ZShjb250YWluZXJSZWN0LndpZHRoIC8gMiwgdGhpcy5ub2RlUGFyc2VyLmhlaWdodCkuc2NhbGUoMSlcclxuICAgICAgKTtcclxuXHJcbiAgICAvL0FkZCBjb250YWluZXIgZyBlbGVtZW50XHJcbiAgICBtZS50YiA9IG1lLnN2Zy5zZWxlY3RBbGwoJ2cudG9vbGJhcicpXHJcbiAgICAgIC5kYXRhKFt7IGlkOiAndG9vbGJhcicgfV0sIChkOiB7IGlkOiBzdHJpbmcgfSkgPT4gZC5pZClcclxuICAgICAgLmpvaW4oXHJcbiAgICAgICAgZW50ZXIgPT4gZW50ZXJcclxuICAgICAgICAgIC5hcHBlbmQoJ2cnKVxyXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3Rvb2xiYXInKVxyXG4gICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoMTAsMTApYClcclxuICAgICAgICAgIC5hcHBlbmQoJ3JlY3QnKVxyXG4gICAgICAgICAgLmF0dHIoJ3dpZHRoJywgMzApXHJcbiAgICAgICAgICAuYXR0cignaGVpZ2h0JywgMzApXHJcbiAgICAgICAgICAuYXR0cignZmlsbCcsICd1cmwoI2ltZy1maXQtaWNvbiknKVxyXG4gICAgICAgICAgLmF0dHIoJ2N1cnNvcicsICdwb2ludGVyJylcclxuICAgICAgICAgIC5vbignY2xpY2snLCAoKSA9PiBtZS5maXQoKSksXHJcbiAgICAgICAgdXBkYXRlID0+IHVwZGF0ZVxyXG4gICAgICApXHJcbiAgICBtZS5wcmVwYXJlRGVmcygpO1xyXG4gIH1cclxuXHJcbiAgLy8gcHJlcGFyaW5nIGRlZnNcclxuICBwcmVwYXJlRGVmcygpIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuICAgIC8vIGRlZnNcclxuICAgIG1lLmRlZnMgPSBtZS5zdmcuc2VsZWN0QWxsKCdkZWZzLmdsb2JhbERlZnMnKVxyXG4gICAgICAuZGF0YShbeyBpZDogJ2RlZnMnIH1dLCAoZDogeyBpZDogc3RyaW5nIH0pID0+IGQuaWQpXHJcbiAgICAgIC5qb2luKFxyXG4gICAgICAgIGVudGVyID0+IHtcclxuICAgICAgICAgIGNvbnN0IGRlZnMgPSBlbnRlci5hcHBlbmQoJ2RlZnMnKS5hdHRyKCdjbGFzcycsICdnbG9iYWxEZWZzJyk7XHJcbiAgICAgICAgICBhZGREZWZhdWx0RGVmcyhkZWZzLCB7XHJcbiAgICAgICAgICAgICdleHBhbmQtaWNvbic6IHtcclxuICAgICAgICAgICAgICB0eXBlOiAnaWNvbicsXHJcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzA1QzM1NicsXHJcbiAgICAgICAgICAgICAgc2NhbGU6IDAuNixcclxuICAgICAgICAgICAgICBjb2xvcjogJyNFQUZBNDgnLFxyXG4gICAgICAgICAgICAgIG5hbWU6ICdmYVBsdXMnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdjb2xsYXBzZS1pY29uJzoge1xyXG4gICAgICAgICAgICAgIHR5cGU6ICdpY29uJyxcclxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjRDEwMzAzJyxcclxuICAgICAgICAgICAgICBzY2FsZTogMC42LFxyXG4gICAgICAgICAgICAgIGNvbG9yOiAnI0VBRkE0OCcsXHJcbiAgICAgICAgICAgICAgbmFtZTogJ2ZhTWludXMnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdmaXQtaWNvbic6IHtcclxuICAgICAgICAgICAgICB0eXBlOiAnaWNvbicsXHJcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzA3NEVGMycsXHJcbiAgICAgICAgICAgICAgc2NhbGU6IDAuOSxcclxuICAgICAgICAgICAgICBjb2xvcjogJyNFQUZBNDgnLFxyXG4gICAgICAgICAgICAgIG5hbWU6ICdmYUV4cGFuZCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ2RlZmF1bHQtbm9kZS1pbWcnOiBtZS5ub2RlUGFyc2VyLmRlZmF1bHRJbWFnZSBhcyBJSW1hZ2VEZWZcclxuICAgICAgICAgIH0sIG1lLm5vZGVQYXJzZXIpXHJcbiAgICAgICAgICAvL2FkZERlZnMoZGVmcywgbWUuZGVmc0VsZW1lbnRzKTtcclxuICAgICAgICAgIHJldHVybiBkZWZzXHJcbiAgICAgICAgfSxcclxuICAgICAgICB1cGRhdGUgPT4gdXBkYXRlXHJcbiAgICAgIClcclxuICB9XHJcblxyXG4gIC8vIHByZXBhcmluZyBkYXRhXHJcbiAgcHJvdGVjdGVkIHByZXBhcmVEYXRhKCkge1xyXG4gICAgY29uc3QgbWUgPSB0aGlzO1xyXG5cclxuICAgIC8vIGlmIG5vIGRhdGEgcmV0dXJuIFxyXG4gICAgaWYgKCFtZS5kYXRhLmxlbmd0aCkgcmV0dXJuO1xyXG5cclxuICAgIC8vIENvbnZlcnQgZmxhdCBkYXRhIHRvIGhpZXJhcmNoaWNhbFxyXG4gICAgaWYgKCFtZS5yb290KSB7XHJcbiAgICAgIHRyeSB7IC8vIHByZXZlbnRpbmcgbXVsdGlwbGUgcm9vdFxyXG4gICAgICAgIG1lLnJvb3QgPSBkMy5zdHJhdGlmeTxJRDNOb2RlPigpLmlkKCh7IG5vZGVJZCB9KSA9PiBub2RlSWQpLnBhcmVudElkKCh7IHBhcmVudE5vZGVJZCB9KSA9PiBwYXJlbnROb2RlSWQpXHJcbiAgICAgICAgICAobWUuZGF0YSkgYXMgZDMuSGllcmFyY2h5UG9pbnROb2RlPElEM05vZGU+O1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBtZS5yb290ID0gZDMuc3RyYXRpZnk8SUQzTm9kZT4oKS5pZCgoeyBub2RlSWQgfSkgPT4gbm9kZUlkKS5wYXJlbnRJZCgoeyBwYXJlbnROb2RlSWQgfSkgPT4gcGFyZW50Tm9kZUlkKVxyXG4gICAgICAgICAgKFt7XHJcbiAgICAgICAgICAgIG5vZGVJZDogJ3Jvb3QnLFxyXG4gICAgICAgICAgICBwYXJlbnROb2RlSWQ6ICcnLFxyXG4gICAgICAgICAgICB0aXRsZTogJ0Vycm9yJyxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGVyci5tZXNzYWdlIHx8IGVycixcclxuICAgICAgICAgICAgbm9kZUltYWdlOiB7XHJcbiAgICAgICAgICAgICAgdHlwZTogJ2Jhc2U2NCcsXHJcbiAgICAgICAgICAgICAgZGF0YTogbWUubm9kZVBhcnNlci5lcnJvckJhc2U2NEljb25cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfV0pIGFzIGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIHByZXBhcmluZyB0cmVlbWFwXHJcbiAgICBjb25zdCBjb250YWluZXJSZWN0ID0gbWUuY29udGFpbmVyLm5vZGUoKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIG1lLnRyZWVtYXAgPSBkMy50cmVlPElEM05vZGU+KCkgLy8uc2l6ZShbY29udGFpbmVyUmVjdC53aWR0aCB8fCAyNTAsIGNvbnRhaW5lclJlY3QuaGVpZ2h0XSlcclxuICAgICAgLm5vZGVTaXplKFtcclxuICAgICAgICAobWUubm9kZVBhcnNlci53aWR0aCArICh0aGlzLm5vZGVQYXJzZXIud2lkdGggKiBtZS5vcHRpb25zLm5vZGVIb3Jpem9udGFsU3BhY2VTY2FsZSB8fCAwLjUpKSAqIDAsXHJcbiAgICAgICAgKG1lLm5vZGVQYXJzZXIuaGVpZ2h0ICsgKHRoaXMubm9kZVBhcnNlci5oZWlnaHQgKiBtZS5vcHRpb25zLm5vZGVWZXJ0aWNhbFNwYWNlU2NhbGUgfHwgMC44KSkgKiAwXHJcbiAgICAgIF0pXHJcbiAgICAgIC5zZXBhcmF0aW9uKChhOiBkMy5IaWVyYXJjaHlQb2ludE5vZGU8SUQzTm9kZT4sIGI6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPikgPT4ge1xyXG4gICAgICAgIHJldHVybiAxXHJcbiAgICAgIH0pXHJcbiAgICAvLyBtZS5hbGxOb2RlcyA9IG1lLnRyZWVtYXAobWUucm9vdCkuZGVzY2VuZGFudHMoKTtcclxuICAgIG1lLmNoZWNrRXhwYW5kZWQobWUucm9vdCk7XHJcbiAgfVxyXG5cclxuICAvLyBzaG93aW5nIG5vZGVzXHJcbiAgcHJvdGVjdGVkIHNob3dOb2Rlcyhwck5vZGU6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPiA9IG51bGwpIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuXHJcbiAgICBpZiAoIXByTm9kZSkgcHJOb2RlID0gbWUucm9vdDtcclxuICAgIGNvbnN0IG5vZGVSZWYgPSB7XHJcbiAgICAgIHg6IHByTm9kZS54IHx8IDAsXHJcbiAgICAgIHk6IHByTm9kZS55IHx8IDAsXHJcbiAgICAgIHBhcmVudDogcHJOb2RlLnBhcmVudFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBjb25zb2xlLmxvZygnTm9kZSBCZWZvcmU6ICcsIG5vZGVSZWYueCk7XHJcbiAgICBjb25zdCB1cGRhdGVQb3NpdGlvbjogeyB4OiBudW1iZXIsIHk6IG51bWJlciB9ID0ge1xyXG4gICAgICB4OiBwck5vZGUueCB8fCAwLFxyXG4gICAgICB5OiBwck5vZGUueSB8fCAwXHJcbiAgICB9XHJcblxyXG4gICAgLy8gIEFzc2lnbnMgdGhlIHggYW5kIHkgcG9zaXRpb24gZm9yIHRoZSBub2Rlc1xyXG4gICAgY29uc3QgdHJlZURhdGEgPSBtZS50cmVlbWFwKG1lLnJvb3QpO1xyXG4gICAgLy8gaXQgaXMgbmVjZXNhcnkgZm9yIHNjb3BlIFxyXG4gICAgY29uc3QgZHJhd05vZGVzID0gKGNvbnRhaW5lcikgPT4gbWUubm9kZVBhcnNlci5kcmF3Tm9kZXMoY29udGFpbmVyLCBtZS5vbk5vZGVDbGljayk7XHJcbiAgICBjb25zdCBkcmF3Q29sbGFwc2VyID0gKG5vZGVHcm91cDogZDMuU2VsZWN0aW9uPFNWR0dFbGVtZW50LCBkMy5IaWVyYXJjaHlQb2ludE5vZGU8SUQzTm9kZT4sIGFueSwgYW55PikgPT4ge1xyXG4gICAgICBub2RlR3JvdXAuYXBwZW5kKCdjaXJjbGUnKVxyXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdjb2xsYXBzZXInKVxyXG4gICAgICAgIC5hdHRyKCdjeCcsIG1lLm5vZGVQYXJzZXIud2lkdGggLyAyKVxyXG4gICAgICAgIC5hdHRyKCdjeScsIG1lLm5vZGVQYXJzZXIuaGVpZ2h0KVxyXG4gICAgICAgIC5hdHRyKCdyJywgMTUpXHJcbiAgICAgICAgLmF0dHIoJ3N0cm9rZScsICdibGFjaycpXHJcbiAgICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDIpXHJcbiAgICAgICAgLm9uKCdjbGljaycsIChub2RlKSA9PiB7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnTm9kZSBYOiAnLCBub2RlLngpXHJcbiAgICAgICAgICBkMy5ldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgbWUuZXhwYW5kKG5vZGUsIHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8vIGNvbnNvbGUubG9nKCdOb2RlIHJlZjogJywgcHJOb2RlLngsIG5vZGVSZWYueCwgbm9kZVJlZiApXHJcbiAgICBjb25zdCBub2RlcyA9IHRyZWVEYXRhLmRlc2NlbmRhbnRzKCk7XHJcblxyXG4gICAgLy8gcHJvYmFuZGluZ1xyXG4gICAgYnVpbGRUcmVlKFxyXG4gICAgICBtZS5yb290LFxyXG4gICAgICB7XHJcbiAgICAgICAgdzogbWUubm9kZVBhcnNlci53aWR0aCArICh0aGlzLm5vZGVQYXJzZXIud2lkdGggKiBtZS5vcHRpb25zLm5vZGVIb3Jpem9udGFsU3BhY2VTY2FsZSB8fCAwLjUpLFxyXG4gICAgICAgIGg6IG1lLm5vZGVQYXJzZXIuaGVpZ2h0ICsgKHRoaXMubm9kZVBhcnNlci5oZWlnaHQgKiBtZS5vcHRpb25zLm5vZGVWZXJ0aWNhbFNwYWNlU2NhbGUgfHwgMC44KVxyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIC8vIGNvbnNvbGUubG9nKCdOb2RlczogJywgbm9kZXMpO1xyXG4gICAgLy8gcHJlcGFyaW5nIGFsbCBkZWZpbml0aW9ucyBmb3Igbm9kZXNcclxuICAgIG1lLmRlZnMuc2VsZWN0QWxsKCdwYXR0ZXJuLm5vZGUnKVxyXG4gICAgICAuZGF0YShub2RlcywgKGQ6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPikgPT4gZC5kYXRhLm5vZGVJZClcclxuICAgICAgLmpvaW4oXHJcbiAgICAgICAgZW50ZXIgPT5cclxuICAgICAgICAgIGVudGVyLmZpbHRlcihkID0+IGQuZGF0YS5ub2RlSW1hZ2UgIT0gbnVsbClcclxuICAgICAgICAgICAgLmFwcGVuZCgncGF0dGVybicpLmF0dHIoJ2NsYXNzJywgJ25vZGUnKVxyXG4gICAgICAgICAgICAuZWFjaCgobm9kZURhdGEsIGksIGVudGVyTm9kZXMpID0+IHtcclxuICAgICAgICAgICAgICAvLyBhZGRpbmcgcGF0dGVyblxyXG4gICAgICAgICAgICAgIGNvbnN0IHBhdHRlcm4gPSBkMy5zZWxlY3QoZW50ZXJOb2Rlc1tpXSk7XHJcbiAgICAgICAgICAgICAgc2V0UGF0dGVybihwYXR0ZXJuLCBub2RlRGF0YS5kYXRhLCBtZS5ub2RlUGFyc2VyKTtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgdXBkYXRlID0+IHVwZGF0ZSxcclxuICAgICAgICBleGl0ID0+IGV4aXRcclxuICAgICAgICAgIC50cmFuc2l0aW9uKClcclxuICAgICAgICAgIC5kdXJhdGlvbihtZS5ub2RlUGFyc2VyLnRyYW5zaXRpb25EdXJhdGlvbilcclxuICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMClcclxuICAgICAgICAgIC5yZW1vdmUoKVxyXG4gICAgICApXHJcblxyXG4gICAgLy8gcmVuZGVyaW5nIG5vZGVzXHJcbiAgICBjb25zdCBub2RlU3RhcnRQb3NpdGlvbiA9IChkOiBkMy5IaWVyYXJjaHlQb2ludE5vZGU8SUQzTm9kZT4pID0+IHtcclxuICAgICAgaWYgKG5vZGVSZWYpIHtcclxuICAgICAgICByZXR1cm4gYHRyYW5zbGF0ZSgke25vZGVSZWYueCAtIChtZS5ub2RlUGFyc2VyLndpZHRoIC8gMil9LCR7bm9kZVJlZi55fSlgXHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFkLnBhcmVudCkgcmV0dXJuIGB0cmFuc2xhdGUoJHtkLnggLSAobWUubm9kZVBhcnNlci53aWR0aCAvIDIpfSwke2QueX0pYDtcclxuICAgICAgcmV0dXJuIGB0cmFuc2xhdGUoJHtkLnBhcmVudC54IC0gKG1lLm5vZGVQYXJzZXIud2lkdGggLyAyKX0sJHtkLnBhcmVudC55fSlgXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29sbGFwc2VyU3RhcnRQb3NpdGlvbiA9IChkOiBkMy5IaWVyYXJjaHlQb2ludE5vZGU8SUQzTm9kZT4pID0+IHtcclxuICAgICAgaWYgKG5vZGVSZWYpIHJldHVybiBub2RlUmVmO1xyXG4gICAgICBpZiAoIWQucGFyZW50KSByZXR1cm4gZDtcclxuICAgICAgcmV0dXJuIGQucGFyZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5vZGVQb3NpdGlvbiA9IChwYXJhbXM6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfSkgPT5cclxuICAgICAgYHRyYW5zbGF0ZSgke3BhcmFtcy54IC0gKG1lLm5vZGVQYXJzZXIud2lkdGggLyAyKX0sJHtwYXJhbXMueX0pYDtcclxuXHJcbiAgICBjb25zdCBjb2xsYXBzZXJQb3NpdGlvbiA9IChwYXJhbXM6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIgfSkgPT5cclxuICAgICAgYHRyYW5zbGF0ZSgke3BhcmFtcy54fSwke3BhcmFtcy55fSlgO1xyXG5cclxuICAgIGNvbnN0IGV4cGFuZEljb25WaXNpYmxlID1cclxuICAgICAgKGQ6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPiAmIHsgX2NoaWxkcmVuPzogYW55IH0pID0+IChkLmNoaWxkcmVuIHx8IGQuX2NoaWxkcmVuKSA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nO1xyXG4gICAgY29uc3QgZXhwYW5kSWNvbiA9XHJcbiAgICAgIChkOiBkMy5IaWVyYXJjaHlQb2ludE5vZGU8SUQzTm9kZT4gJiB7IF9jaGlsZHJlbj86IGFueSB9KSA9PiBleHBhbmRJY29uVmlzaWJsZShkKSA9PSAndmlzaWJsZScgPyAoZC5kYXRhLmV4cGFuZGVkID8gYHVybCgjaW1nLWNvbGxhcHNlLWljb24pYCA6IGB1cmwoI2ltZy1leHBhbmQtaWNvbilgKSA6ICcnO1xyXG4gICAgY29uc3QgY29sbGFwc2VyQ3Vyc29yID1cclxuICAgICAgKGQ6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPiAmIHsgX2NoaWxkcmVuPzogYW55IH0pID0+IGV4cGFuZEljb25WaXNpYmxlKGQpID09ICd2aXNpYmxlJyA/IChkLmRhdGEuZXhwYW5kZWQgPyBgem9vbS1vdXRgIDogYHpvb20taW5gKSA6ICdkZWZhdWx0JztcclxuXHJcblxyXG4gICAgbWUuY2hhcnQuc2VsZWN0QWxsKCdnLm5vZGUnKVxyXG4gICAgICAuZGF0YShub2RlcywgKGQ6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPikgPT4gZC5kYXRhLm5vZGVJZClcclxuICAgICAgLmpvaW4oXHJcbiAgICAgICAgZW50ZXIgPT5cclxuICAgICAgICAgIGVudGVyLmFwcGVuZCgnZycpXHJcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMClcclxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ25vZGUnKVxyXG4gICAgICAgICAgICAuYXR0cignY3Vyc29yJywgJ3BvaW50ZXInKVxyXG4gICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgbm9kZVN0YXJ0UG9zaXRpb24pXHJcbiAgICAgICAgICAgIC5jYWxsKGRyYXdOb2RlcylcclxuICAgICAgICAgICAgLy8gLmNhbGwoZHJhd0NvbGxhcHNlcilcclxuICAgICAgICAgICAgLm9uKCdkYmxjbGljaycsIChub2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IG1lLmNvbnRhaW5lci5ub2RlKCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgbWUudHJhc2xhdGVUbygoY29udGFpbmVyUmVjdC53aWR0aCAvIDIpIC0gbm9kZS54LCAoKGNvbnRhaW5lclJlY3QuaGVpZ2h0IC0gbWUubm9kZVBhcnNlci5oZWlnaHQpIC8gMikgLSBub2RlLnkpXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIHVwZGF0ZSA9PiB1cGRhdGUsXHJcbiAgICAgICAgZXhpdCA9PlxyXG4gICAgICAgICAgZXhpdFxyXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXHJcbiAgICAgICAgICAgIC5kdXJhdGlvbihtZS5ub2RlUGFyc2VyLnRyYW5zaXRpb25EdXJhdGlvbilcclxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIG5vZGVQb3NpdGlvbihwck5vZGUpKVxyXG4gICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApXHJcbiAgICAgICAgICAgIC5yZW1vdmUoKVxyXG4gICAgICApXHJcbiAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24obWUubm9kZVBhcnNlci50cmFuc2l0aW9uRHVyYXRpb24pXHJcbiAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSlcclxuICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIG5vZGVQb3NpdGlvbilcclxuICAgICAgLy8uc2VsZWN0QWxsKCdjaXJjbGUuY29sbGFwc2VyJylcclxuICAgICAgLy8uYXR0cigndmlzaWJpbGl0eScsIGV4cGFuZEljb25WaXNpYmxlKVxyXG4gICAgICAvLy5hdHRyKCdmaWxsJywgZXhwYW5kSWNvbilcclxuXHJcbiAgICBtZS5jaGFydC5zZWxlY3RBbGwoJ2NpcmNsZS5jb2xsYXBzZXInKVxyXG4gICAgICAuZGF0YShub2RlcywgKGQ6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPikgPT4gZC5kYXRhLm5vZGVJZClcclxuICAgICAgLmpvaW4oXHJcbiAgICAgICAgZW50ZXIgPT5cclxuICAgICAgICAgIGVudGVyLmFwcGVuZCgnY2lyY2xlJylcclxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjb2xsYXBzZXInKVxyXG4gICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKVxyXG4gICAgICAgICAgLmF0dHIoJ2N4JywgKGQpID0+IGNvbGxhcHNlclN0YXJ0UG9zaXRpb24oZCkueClcclxuICAgICAgICAgIC5hdHRyKCdjeScsIChkKSA9PiBjb2xsYXBzZXJTdGFydFBvc2l0aW9uKGQpLnkgKyBtZS5ub2RlUGFyc2VyLmhlaWdodClcclxuICAgICAgICAgIC5hdHRyKCdyJywgMTUpXHJcbiAgICAgICAgICAuYXR0cignc3Ryb2tlJywgJ2JsYWNrJylcclxuICAgICAgICAgIC5hdHRyKCdzdHJva2Utd2lkdGgnLCAyKVxyXG4gICAgICAgICAgLm9uKCdjbGljaycsIChub2RlKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdOb2RlIFg6ICcsIG5vZGUueClcclxuICAgICAgICAgICAgZDMuZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgbWUuZXhwYW5kKG5vZGUsIHRydWUpO1xyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgdXBkYXRlID0+IHVwZGF0ZSxcclxuICAgICAgICBleGl0ID0+XHJcbiAgICAgICAgICBleGl0XHJcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24obWUubm9kZVBhcnNlci50cmFuc2l0aW9uRHVyYXRpb24pXHJcbiAgICAgICAgICAgIC5hdHRyKCdjeCcsIChkKSA9PiBjb2xsYXBzZXJTdGFydFBvc2l0aW9uKGQpLngpXHJcbiAgICAgICAgICAgIC5hdHRyKCdjeScsIChkKSA9PiBjb2xsYXBzZXJTdGFydFBvc2l0aW9uKGQpLnkgKyBtZS5ub2RlUGFyc2VyLmhlaWdodClcclxuICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKVxyXG4gICAgICAgICAgICAucmVtb3ZlKClcclxuICAgICAgKVxyXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKG1lLm5vZGVQYXJzZXIudHJhbnNpdGlvbkR1cmF0aW9uKVxyXG4gICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpXHJcbiAgICAgIC5hdHRyKCdjeCcsIChkKSA9PiBkLngpXHJcbiAgICAgIC5hdHRyKCdjeScsIChkKSA9PiBkLnkgKyBtZS5ub2RlUGFyc2VyLmhlaWdodClcclxuICAgICAgLmF0dHIoJ3Zpc2liaWxpdHknLCBleHBhbmRJY29uVmlzaWJsZSlcclxuICAgICAgLmF0dHIoJ2ZpbGwnLCBleHBhbmRJY29uKVxyXG4gICAgICAuYXR0cignY3Vyc29yJywgY29sbGFwc2VyQ3Vyc29yKVxyXG5cclxuXHJcblxyXG4gICAgLy8gcmVuZGVyaW5nIGxpbmtzXHJcbiAgICBjb25zdCBwYXRoU3RhcnRpbmdEaWFnb25hbCA9IChkOiB7IHg6IG51bWJlciwgeTogbnVtYmVyLCBwYXJlbnQ6IElSb290Tm9kZTxJRDNOb2RlPiB9KSA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxpbmtQYXRoKGQsIGQpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF0aERpYWdvbmFsID0gKGQ6IElSb290Tm9kZTxJRDNOb2RlPikgPT4ge1xyXG4gICAgICBjb25zdCB0YXJnZXQgPSB7IHg6IGQucGFyZW50LngsIHk6IGQucGFyZW50LnkgKyBtZS5ub2RlUGFyc2VyLmhlaWdodCB9O1xyXG4gICAgICByZXR1cm4gdGhpcy5saW5rUGF0aChkLCBkLnBhcmVudClcclxuICAgIH1cclxuXHJcbiAgICBtZS5jaGFydC5zZWxlY3RBbGwoJ3BhdGgubGluaycpXHJcbiAgICAgIC5kYXRhKG5vZGVzLnNsaWNlKDEpLCAoZDogZDMuSGllcmFyY2h5UG9pbnROb2RlPElEM05vZGU+KSA9PiBkLmRhdGEubm9kZUlkKVxyXG4gICAgICAuam9pbihcclxuICAgICAgICBlbnRlciA9PlxyXG4gICAgICAgICAgZW50ZXJcclxuICAgICAgICAgICAgLmluc2VydCgncGF0aCcsICdnJylcclxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2xpbmsnKVxyXG4gICAgICAgICAgICAuYXR0cignZmlsbCcsICdub25lJylcclxuICAgICAgICAgICAgLmF0dHIoJ3N0cm9rZScsICdibHVlJylcclxuICAgICAgICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDIpXHJcbiAgICAgICAgICAgIC5hdHRyKCdkJywgcGF0aFN0YXJ0aW5nRGlhZ29uYWwobm9kZVJlZikpLFxyXG4gICAgICAgIHVwZGF0ZSA9PiB1cGRhdGUsXHJcbiAgICAgICAgZXhpdCA9PlxyXG4gICAgICAgICAgZXhpdFxyXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKG1lLm5vZGVQYXJzZXIudHJhbnNpdGlvbkR1cmF0aW9uKVxyXG4gICAgICAgICAgICAuYXR0cignZCcsIHBhdGhTdGFydGluZ0RpYWdvbmFsKHByTm9kZSkpXHJcbiAgICAgICAgICAgIC5yZW1vdmUoKVxyXG4gICAgICApXHJcbiAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24obWUubm9kZVBhcnNlci50cmFuc2l0aW9uRHVyYXRpb24pXHJcbiAgICAgIC5hdHRyKCdkJywgcGF0aERpYWdvbmFsKTtcclxuICB9XHJcblxyXG4gIC8vIFpvb20gaGFuZGxlciBmdW5jdGlvblxyXG4gIHpvb21lZCgpIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuICAgIC8vIFNhdmluZyBkMyBldmVudCdzIHRyYW5zZm9ybSBvYmplY3RcclxuICAgIG1lLmxhc3RUcmFuc2Zvcm0gPSBkMy5ldmVudC50cmFuc2Zvcm07XHJcbiAgICAvLyBSZXBvc2l0aW9uIGFuZCByZXNjYWxlIGNoYXJ0IGFjY29yZGluZ2x5XHJcbiAgICBpZiAoaXNOYU4obWUubGFzdFRyYW5zZm9ybS5rKSB8fCBpc05hTihtZS5sYXN0VHJhbnNmb3JtLngpIHx8IGlzTmFOKG1lLmxhc3RUcmFuc2Zvcm0ueSkpIHJldHVybjtcclxuXHJcbiAgICBtZS5jaGFydC5hdHRyKCd0cmFuc2Zvcm0nLCBkMy5ldmVudC50cmFuc2Zvcm0pO1xyXG4gIH1cclxuXHJcbiAgLy8jcmVnaW9uIEV2ZW50c1xyXG4gIC8vIG5vZGUgY2xpY2tcclxuICBvbk5vZGVDbGljazogU3ViamVjdDx7IGlkOiBzdHJpbmcsIG5vZGU6IElEM05vZGUgfT4gPSBuZXcgU3ViamVjdCgpO1xyXG4gIHByb3RlY3RlZCBfb25Ob2RlQ2xpY2sobm9kZUlkOiBzdHJpbmcsIG5vZGU6IElEM05vZGUpIHtcclxuICAgIHRoaXMub25Ob2RlQ2xpY2submV4dCh7IGlkOiBub2RlSWQsIG5vZGU6IG5vZGUgfSk7XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyBHZW5lcmF0ZSBjdXN0b20gZGlhZ29uYWwgLSBwbGF5IHdpdGggaXQgaGVyZSAtIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AYnVtYmVpc2h2aWxpL2N1cnZlZC1lZGdlcz9jb2xsZWN0aW9uPUBidW1iZWlzaHZpbGkvd29yay1jb21wb25lbnRzXHJcbiAgbGlua1BhdGgoc291cmNlOiB7IHg6IG51bWJlciwgeTogbnVtYmVyLCBwYXJlbnQ6IElSb290Tm9kZTxJRDNOb2RlPiB9LCB0YXJnZXQ6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIsIHBhcmVudDogSVJvb3ROb2RlPElEM05vZGU+IH0pIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgc29tZSB2YXJpYWJsZXMgYmFzZWQgb24gc291cmNlIGFuZCB0YXJnZXQgKHMsdCkgY29vcmRpbmF0ZXNcclxuICAgIGxldCB4ID0gc291cmNlLng7XHJcbiAgICBsZXQgeSA9IHNvdXJjZS55O1xyXG4gICAgY29uc3QgZXggPSB0YXJnZXQueDtcclxuICAgIGNvbnN0IGV5ID0gdGFyZ2V0LnkgKyBtZS5ub2RlUGFyc2VyLmhlaWdodDtcclxuXHJcbiAgICBjb25zdCBsaW5rSGVpZ2h0ID0gMjU7XHJcbiAgICBjb25zdCBjdXJ2ZVJhZGl1cyA9IE1hdGguYWJzKHggLSBleCkgIT0gMCA/IDE1IDogMDtcclxuXHJcbiAgICBsZXQgeHJ2cyA9IGV4IC0geCA8IDAgPyAtMSA6IDE7XHJcbiAgICBsZXQgeXJ2cyA9IGV5IC0geSA8IDAgPyAtMSA6IDE7XHJcbiAgICBsZXQgdyA9IE1hdGguYWJzKGV4IC0geCkgLSAoY3VydmVSYWRpdXMgKiAyKTtcclxuXHJcbiAgICBjb25zdCBwYXRoID0gYFxyXG4gICAgICBNICR7eH0gJHt5fVxyXG4gICAgICBMICR7eH0gJHt5ICsgKGxpbmtIZWlnaHQgKiB5cnZzKX1cclxuICAgICAgQyAke3h9ICR7eSArICgobGlua0hlaWdodCArIGN1cnZlUmFkaXVzKSAqIHlydnMpfSAke3h9ICR7eSArICgobGlua0hlaWdodCArIGN1cnZlUmFkaXVzKSAqIHlydnMpfSAke3ggKyAoY3VydmVSYWRpdXMgKiB4cnZzKX0gJHt5ICsgKChsaW5rSGVpZ2h0ICsgY3VydmVSYWRpdXMpICogeXJ2cyl9XHJcbiAgICAgIEwgJHt4ICsgKCh3ICsgY3VydmVSYWRpdXMpICogeHJ2cyl9ICR7eSArICgobGlua0hlaWdodCArIGN1cnZlUmFkaXVzKSAqIHlydnMpfVxyXG4gICAgICBDICR7ZXh9ICAke3kgKyAoKGxpbmtIZWlnaHQgKyBjdXJ2ZVJhZGl1cykgKiB5cnZzKX0gJHtleH0gICR7eSArICgobGlua0hlaWdodCArIGN1cnZlUmFkaXVzKSAqIHlydnMpfSAke2V4fSAke3kgKyAoKGxpbmtIZWlnaHQgKyBjdXJ2ZVJhZGl1cykgKiB5cnZzKSArIChjdXJ2ZVJhZGl1cyAqIHlydnMpfVxyXG4gICAgICBMICR7ZXh9ICR7ZXl9XHJcbiAgICBgO1xyXG4gICAgcmV0dXJuIHBhdGg7XHJcbiAgfVxyXG5cclxuICBjaGVja0V4cGFuZGVkKG5vZGU6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPiAmIHsgX2NoaWxkcmVuPzogYW55IH0pIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuXHJcbiAgICAvLyBjaGVja2luZyBleHBhbmRlZFxyXG4gICAgaWYgKG5vZGUuZGF0YS5leHBhbmRlZCkge1xyXG4gICAgICBpZiAoIW5vZGUuY2hpbGRyZW4gJiYgbm9kZS5fY2hpbGRyZW4pIHtcclxuICAgICAgICBub2RlLmNoaWxkcmVuID0gbm9kZS5fY2hpbGRyZW47XHJcbiAgICAgICAgbm9kZS5fY2hpbGRyZW4gPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgeyAvLyBjb2xsYXBzZWRcclxuICAgICAgaWYgKG5vZGUuY2hpbGRyZW4pIHtcclxuICAgICAgICBub2RlLl9jaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47XHJcbiAgICAgICAgbm9kZS5jaGlsZHJlbiA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIGNoZWNraW5nIGNoaWxkcmVuXHJcbiAgICAobm9kZS5jaGlsZHJlbiB8fCBub2RlLl9jaGlsZHJlbiB8fCBbXSkuZm9yRWFjaChjdXJyZW50ID0+IG1lLmNoZWNrRXhwYW5kZWQoY3VycmVudCkpXHJcbiAgfVxyXG5cclxuICBleHBhbmQobm9kZTogZDMuSGllcmFyY2h5UG9pbnROb2RlPElEM05vZGU+ICYgeyBfY2hpbGRyZW4/OiBhbnkgfSwgdG9nZ2xlOiBib29sZWFuID0gZmFsc2UpIHsgLy8sICByZW5kZXI6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgY29uc3QgbWUgPSB0aGlzO1xyXG5cclxuICAgIGNvbnN0IG5vZGVSZWYgPSBPYmplY3QuYXNzaWduKG5vZGUpO1xyXG5cclxuICAgIC8vIGlmIHRvZ2dsZSAtIGxldHMgdG9nZ2xlXHJcbiAgICBpZiAodG9nZ2xlKSBub2RlLmRhdGEuZXhwYW5kZWQgPSAhbm9kZS5kYXRhLmV4cGFuZGVkO1xyXG5cclxuICAgIC8vIGNoZWNraW5nIGV4cGFuZGVkXHJcbiAgICBpZiAobm9kZS5kYXRhLmV4cGFuZGVkKSB7XHJcbiAgICAgIGlmICghbm9kZS5jaGlsZHJlbiAmJiBub2RlLl9jaGlsZHJlbikge1xyXG4gICAgICAgIG5vZGUuY2hpbGRyZW4gPSBub2RlLl9jaGlsZHJlbjtcclxuICAgICAgICBub2RlLl9jaGlsZHJlbiA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7IC8vIGNvbGxhcHNlZFxyXG4gICAgICBpZiAobm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgIG5vZGUuX2NoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjtcclxuICAgICAgICBub2RlLmNoaWxkcmVuID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGV4cGFuZChub2RlLmNoaWxkcmVuLCBub2RlLmRhdGEuZXhwYW5kZWQpO1xyXG4gICAgLy8gY29uc29sZS5sb2coJ0JlZm9yZSBleHBhbmQ6ICcsIG5vZGVSZWYueCwgIG5vZGUueClcclxuICAgIGlmICh0b2dnbGUpIG1lLnNob3dOb2Rlcyhub2RlKTtcclxuICB9XHJcblxyXG4gIHRyYXNsYXRlVG8ocHJYLCBwclkpIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuICAgIG1lLnN2Z1xyXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKG1lLm5vZGVQYXJzZXIudHJhbnNpdGlvbkR1cmF0aW9uKVxyXG4gICAgICAuY2FsbChcclxuICAgICAgICBtZS56b29tRnVuYy50cmFuc2Zvcm0sXHJcbiAgICAgICAgZDMuem9vbUlkZW50aXR5LnRyYW5zbGF0ZShwclgsIHByWSlcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIGZpdCgpIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuICAgIC8vIGNvbnN0IHpvb20gPSBkMy56b29tKCkub24oXCJ6b29tXCIsIGQgPT4gdGhpcy56b29tZWQoKSlcclxuICAgIGlmICghbWUucm9vdCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IGZpdCA9IGNhbGNHRml0KG1lLmNoYXJ0LCBtZS5zdmcsIG1lLnJvb3QsIG1lLm5vZGVQYXJzZXIpXHJcbiAgICBtZS5zdmcudHJhbnNpdGlvbigpLmR1cmF0aW9uKG1lLm5vZGVQYXJzZXIudHJhbnNpdGlvbkR1cmF0aW9uKS5jYWxsKFxyXG4gICAgICBtZS56b29tRnVuYy50cmFuc2Zvcm0sXHJcbiAgICAgIGQzLnpvb21JZGVudGl0eS50cmFuc2xhdGUoZml0LngsIGZpdC55KS5zY2FsZShmaXQuc2NhbGUpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgc2V0T3B0aW9ucyhwck9wdGlvbnM6IFBhcnRpYWw8SUQzT3JnQ2hhcnRPcHRpb25zPikge1xyXG4gICAgY29uc3QgbWUgPSB0aGlzO1xyXG4gICAgbWUub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24obWUub3B0aW9ucywgcHJPcHRpb25zKTtcclxuICB9XHJcbn1cclxuXHJcbiJdfQ==